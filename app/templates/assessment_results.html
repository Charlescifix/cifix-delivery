{% extends "base.html" %}

{% block content %}
<div class="min-h-screen py-8">
    <div class="max-w-4xl mx-auto px-4">
        <!-- Results Header -->
        <div class="modern-card text-center mb-8">
            <div class="mb-6">
                {% if attempt.percentage >= 80 %}
                <div class="w-24 h-24 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                        <path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" />
                    </svg>
                </div>
                <h1 class="title-secondary text-green-600 mb-2">Excellent Work!</h1>
                {% elif attempt.percentage >= 70 %}
                <div class="w-24 h-24 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                        <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z" />
                    </svg>
                </div>
                <h1 class="title-secondary text-blue-600 mb-2">Great Job!</h1>
                {% else %}
                <div class="w-24 h-24 bg-gradient-to-br from-orange-500 to-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="white">
                        <path d="M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z" />
                    </svg>
                </div>
                <h1 class="title-secondary text-orange-600 mb-2">Keep Learning!</h1>
                {% endif %}
                
                <p class="text-xl text-gray-600">{{ module.title }} Assessment Results</p>
            </div>

            <!-- Score Summary -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="modern-card bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200">
                    <div class="text-3xl font-bold text-blue-600 mb-2">{{ attempt.score }}</div>
                    <div class="text-sm text-gray-600">out of {{ total_questions }}</div>
                    <div class="text-xs text-gray-500 mt-1">Correct Answers</div>
                </div>
                
                <div class="modern-card bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-200">
                    <div class="text-3xl font-bold text-purple-600 mb-2">{{ attempt.percentage }}%</div>
                    <div class="text-xs text-gray-500 mt-1">Overall Score</div>
                </div>
                
                <div class="modern-card bg-gradient-to-br from-yellow-50 to-orange-50 border-2 border-yellow-200">
                    <div class="text-3xl font-bold text-yellow-600 mb-2">‚≠ê {{ attempt.stars_earned }}</div>
                    <div class="text-xs text-gray-500 mt-1">Stars Earned</div>
                </div>
                
                <div class="modern-card bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
                    <div class="text-3xl font-bold text-green-600 mb-2">
                        {% if attempt.score >= passing_score %}‚úÖ{% else %}üìö{% endif %}
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        {% if attempt.score >= passing_score %}Passed!{% else %}Keep Trying{% endif %}
                    </div>
                </div>
            </div>

            <!-- Performance Message -->
            {% if attempt.percentage >= 90 %}
            <div class="alert-success">
                üåü <strong>Outstanding!</strong> You've mastered this topic! You're ready for the next challenge.
            </div>
            {% elif attempt.percentage >= 80 %}
            <div class="alert-success">
                üéâ <strong>Excellent work!</strong> You have a strong understanding of Python basics.
            </div>
            {% elif attempt.percentage >= 70 %}
            <div class="alert-info">
                üëç <strong>Good job!</strong> You're on the right track. Review the questions you missed and try again!
            </div>
            {% else %}
            <div class="alert-error">
                üìñ <strong>Keep learning!</strong> Review the module content and take the assessment again when you're ready.
            </div>
            {% endif %}
        </div>

        <!-- Detailed Results -->
        <div class="modern-card mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-6">üìã Detailed Results</h3>
            
            <div class="space-y-6">
                {% for question in questions %}
                <div class="border-2 {% if question.is_correct %}border-green-200 bg-green-50{% else %}border-red-200 bg-red-50{% endif %} rounded-lg p-4">
                    <div class="flex items-start gap-3 mb-3">
                        <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center {% if question.is_correct %}bg-green-500 text-white{% else %}bg-red-500 text-white{% endif %}">
                            {{ question.id }}
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-800 mb-2">{{ question.question }}</h4>
                            
                            <!-- Answer Options -->
                            <div class="space-y-2">
                                {% for i in range(question.options|length) %}
                                <div class="flex items-center p-2 rounded 
                                    {% if i == question.correct_answer %}bg-green-100 border-l-4 border-green-500{% elif question.student_answer is not none and i == question.student_answer and i != question.correct_answer %}bg-red-100 border-l-4 border-red-500{% else %}bg-gray-50{% endif %}">
                                    <span class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-3 text-sm
                                        {% if i == question.correct_answer %}bg-green-500 border-green-500 text-white{% elif question.student_answer is not none and i == question.student_answer and i != question.correct_answer %}bg-red-500 border-red-500 text-white{% else %}border-gray-300{% endif %}">
                                        {% if i == question.correct_answer %}‚úì{% elif question.student_answer is not none and i == question.student_answer and i != question.correct_answer %}‚úó{% else %}{{ 'ABCD'[i] }}{% endif %}
                                    </span>
                                    <span class="{% if i == question.correct_answer %}font-semibold text-green-700{% elif question.student_answer is not none and i == question.student_answer and i != question.correct_answer %}font-semibold text-red-700{% endif %}">
                                        {{ question.options[i] }}
                                        {% if i == question.correct_answer %}<span class="text-green-600 font-bold ml-2">(Correct Answer)</span>{% endif %}
                                        {% if question.student_answer is not none and i == question.student_answer and i != question.correct_answer %}<span class="text-red-600 font-bold ml-2">(Your Answer)</span>{% endif %}
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Explanation -->
                            {% if not question.is_correct %}
                            <div class="mt-3 p-3 bg-blue-50 border-l-4 border-blue-400 rounded-r">
                                <p class="text-blue-700 font-medium">üí° {{ question.explanation }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="modern-card bg-gradient-to-br from-indigo-500 to-purple-600 text-white border-none">
            <div class="text-center">
                <h3 class="text-xl font-bold mb-6">What's Next?</h3>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <a href="/dashboard" class="modern-btn bg-white text-indigo-600 hover:bg-gray-100">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z" />
                        </svg>
                        Back to Dashboard
                    </a>
                    
                    {% if attempt.score < passing_score %}
                    <a href="/modules/{{ module.id }}" class="modern-btn bg-yellow-500 hover:bg-yellow-600 text-white">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,3L1,9L12,15L21,10.09V17H23V9M5,13.18V17.18L12,21L19,17.18V13.18L12,17L5,13.18Z" />
                        </svg>
                        Review Module
                    </a>
                    {% endif %}
                    
                    <a href="/modules/{{ module.id }}/assessment" class="modern-btn bg-green-500 hover:bg-green-600 text-white">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M13,9H18.5L13,3.5V9M6,2H14L20,8V20A2,2 0 0,1 18,22H6C4.89,22 4,21.1 4,20V4C4,2.89 4.89,2 6,2M15,18V16H6V18H15M18,14V12H6V14H18Z" />
                        </svg>
                        Try Again
                    </a>
                </div>
                
                {% if attempt.score >= passing_score %}
                <div class="mt-6 p-4 bg-white/20 rounded-lg backdrop-blur-sm">
                    <p class="text-lg font-medium mb-2">üéä Congratulations!</p>
                    <p class="opacity-90">You've successfully completed this module. Keep up the great work!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}